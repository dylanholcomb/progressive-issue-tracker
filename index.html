<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Progressive Issue Tracker</title>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://unpkg.com/papaparse@5.4.1/papaparse.min.js"></script>
  <style>
    * { box-sizing: border-box; }
    body { margin: 0; font-family: system-ui, -apple-system, sans-serif; }
    @keyframes spin { to { transform: rotate(360deg); } }
    .spinner { animation: spin 1s linear infinite; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel" data-presets="react">
    const { useState, useEffect } = React;

    // Google Sheet CSV URL
    const SHEET_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRSqXLagQ5mRRHHnf7-3aIpqCwSTTIS13piFHefooXdOwEOy9bW0p_4xyrNhryGug/pub?output=csv';

    const priorityStyles = {
      RED: { bg: '#FEE2E2', text: '#DC2626', label: 'üî¥ Urgent', gradient: 'linear-gradient(135deg, #EF4444, #E11D48)' },
      YELLOW: { bg: '#FEF3C7', text: '#D97706', label: 'üü° Important', gradient: 'linear-gradient(135deg, #F59E0B, #EA580C)' },
      GREEN: { bg: '#D1FAE5', text: '#059669', label: 'üü¢ Monitor', gradient: 'linear-gradient(135deg, #10B981, #14B8A6)' }
    };

    const levelStyles = {
      Federal: { bg: '#DBEAFE', text: '#1D4ED8' },
      State: { bg: '#F3E8FF', text: '#7C3AED' },
      Local: { bg: '#CCFBF1', text: '#0D9488' }
    };

    // Parse priority from spreadsheet (handles emoji format like "üî¥ RED")
    function parsePriority(value) {
      if (!value) return 'GREEN';
      const upper = value.toUpperCase();
      if (upper.includes('RED')) return 'RED';
      if (upper.includes('YELLOW')) return 'YELLOW';
      return 'GREEN';
    }

    // Parse contacted status
    function parseContacted(value) {
      if (!value) return false;
      const lower = value.toLowerCase();
      return lower === 'yes' || lower === 'true' || lower === 'y';
    }

    function App() {
      const [bills, setBills] = useState([]);
      const [loading, setLoading] = useState(true);
      const [error, setError] = useState(null);
      const [lastUpdated, setLastUpdated] = useState(null);
      const [searchTerm, setSearchTerm] = useState('');
      const [levelFilter, setLevelFilter] = useState('All');
      const [priorityFilter, setPriorityFilter] = useState('All');
      const [selectedBill, setSelectedBill] = useState(null);

      // Fetch data from Google Sheet
      useEffect(() => {
        fetchData();
      }, []);

      const fetchData = () => {
        setLoading(true);
        fetch(SHEET_URL)
          .then(response => response.text())
          .then(csvText => {
            Papa.parse(csvText, {
              header: true,
              skipEmptyLines: true,
              complete: (results) => {
                const parsedBills = results.data.map((row, index) => ({
                  id: index + 1,
                  dateAdded: row['Date Added'] || '',
                  level: row['Level'] || 'Federal',
                  billIssue: row['Bill/Issue'] || '',
                  description: row['Description'] || '',
                  status: row['Status'] || '',
                  actionDeadline: row['Action Deadline'] || null,
                  priority: parsePriority(row['Priority']),
                  takeAction: row['Take Action?'] === '‚òë' || row['Take Action?'] === 'Yes',
                  repsToContact: row['Reps to Contact'] || '',
                  contacted: parseContacted(row['Contacted?']),
                  notes: row['Outcome/Notes'] || ''
                })).filter(bill => bill.billIssue); // Filter out empty rows

                setBills(parsedBills);
                setLastUpdated(new Date());
                setLoading(false);
              },
              error: (err) => {
                setError('Failed to parse spreadsheet data');
                setLoading(false);
              }
            });
          })
          .catch(err => {
            setError('Failed to fetch data from Google Sheet');
            setLoading(false);
          });
      };

      const filteredBills = bills.filter(bill => {
        const matchesSearch = bill.billIssue.toLowerCase().includes(searchTerm.toLowerCase()) ||
                              bill.description.toLowerCase().includes(searchTerm.toLowerCase());
        const matchesLevel = levelFilter === 'All' || bill.level === levelFilter;
        const matchesPriority = priorityFilter === 'All' || bill.priority === priorityFilter;
        return matchesSearch && matchesLevel && matchesPriority;
      });

      const stats = {
        total: bills.length,
        urgent: bills.filter(b => b.priority === 'RED').length,
        contacted: bills.filter(b => b.contacted).length
      };

      if (loading) {
        return (
          <div style={{minHeight: '100vh', background: 'linear-gradient(135deg, #0F172A 0%, #581C87 50%, #0F172A 100%)', display: 'flex', alignItems: 'center', justifyContent: 'center'}}>
            <div style={{textAlign: 'center', color: 'white'}}>
              <div className="spinner" style={{width: '48px', height: '48px', border: '4px solid rgba(255,255,255,0.2)', borderTopColor: '#8B5CF6', borderRadius: '50%', margin: '0 auto 16px'}}></div>
              <p style={{margin: 0, fontSize: '18px'}}>Loading bills from Google Sheet...</p>
            </div>
          </div>
        );
      }

      if (error) {
        return (
          <div style={{minHeight: '100vh', background: 'linear-gradient(135deg, #0F172A 0%, #581C87 50%, #0F172A 100%)', display: 'flex', alignItems: 'center', justifyContent: 'center'}}>
            <div style={{textAlign: 'center', color: 'white', padding: '24px'}}>
              <p style={{fontSize: '48px', margin: '0 0 16px 0'}}>‚ö†Ô∏è</p>
              <p style={{margin: '0 0 16px 0', fontSize: '18px'}}>{error}</p>
              <button onClick={fetchData} style={{padding: '12px 24px', background: '#8B5CF6', border: 'none', borderRadius: '8px', color: 'white', fontWeight: '600', cursor: 'pointer'}}>
                Try Again
              </button>
            </div>
          </div>
        );
      }

      return (
        <div style={{minHeight: '100vh', background: 'linear-gradient(135deg, #0F172A 0%, #581C87 50%, #0F172A 100%)'}}>
          {/* Header */}
          <header style={{background: 'rgba(0,0,0,0.3)', backdropFilter: 'blur(10px)', borderBottom: '1px solid rgba(255,255,255,0.1)', padding: '24px 16px'}}>
            <div style={{maxWidth: '1200px', margin: '0 auto', display: 'flex', alignItems: 'center', justifyContent: 'space-between', flexWrap: 'wrap', gap: '16px'}}>
              <div style={{display: 'flex', alignItems: 'center', gap: '16px'}}>
                <div style={{width: '48px', height: '48px', borderRadius: '12px', background: 'linear-gradient(135deg, #8B5CF6, #D946EF)', display: 'flex', alignItems: 'center', justifyContent: 'center', boxShadow: '0 10px 30px rgba(139, 92, 246, 0.3)'}}>
                  <span style={{fontSize: '24px'}}>‚ö°</span>
                </div>
                <div>
                  <h1 style={{margin: 0, fontSize: '24px', fontWeight: 'bold', color: 'white'}}>Progressive Issue Tracker</h1>
                  <p style={{margin: 0, fontSize: '14px', color: 'rgba(216, 180, 254, 0.7)'}}>Track bills, take action, make change</p>
                </div>
              </div>
              <div style={{display: 'flex', alignItems: 'center', gap: '16px'}}>
                <button
                  onClick={fetchData}
                  style={{padding: '8px 16px', background: 'rgba(255,255,255,0.1)', border: '1px solid rgba(255,255,255,0.2)', borderRadius: '8px', color: 'white', fontSize: '14px', cursor: 'pointer', display: 'flex', alignItems: 'center', gap: '8px'}}
                >
                  üîÑ Refresh
                </button>
                <div style={{textAlign: 'right'}}>
                  <p style={{margin: 0, fontSize: '12px', color: 'rgba(255,255,255,0.5)'}}>Live from Google Sheet</p>
                  <p style={{margin: 0, color: 'white', fontWeight: '500', fontSize: '14px'}}>
                    {lastUpdated ? lastUpdated.toLocaleTimeString() : ''}
                  </p>
                </div>
              </div>
            </div>
          </header>

          <main style={{maxWidth: '1200px', margin: '0 auto', padding: '32px 16px'}}>
            {/* Stats */}
            <div style={{display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(150px, 1fr))', gap: '16px', marginBottom: '32px'}}>
              <StatCard emoji="üìã" label="Active Issues" value={stats.total} color="#3B82F6" />
              <StatCard emoji="üî¥" label="Urgent" value={stats.urgent} color="#EF4444" />
              <StatCard emoji="‚úÖ" label="Contacted" value={stats.contacted} color="#10B981" />
            </div>

            {/* Search & Filters */}
            <div style={{background: 'rgba(255,255,255,0.05)', backdropFilter: 'blur(10px)', borderRadius: '16px', border: '1px solid rgba(255,255,255,0.1)', padding: '16px', marginBottom: '24px'}}>
              <div style={{display: 'flex', flexWrap: 'wrap', gap: '12px', alignItems: 'center'}}>
                <input
                  type="text"
                  placeholder="üîç Search bills..."
                  value={searchTerm}
                  onChange={(e) => setSearchTerm(e.target.value)}
                  style={{flex: '1 1 200px', padding: '12px 16px', background: 'rgba(255,255,255,0.1)', border: '1px solid rgba(255,255,255,0.1)', borderRadius: '12px', color: 'white', fontSize: '14px', outline: 'none'}}
                />
                <select
                  value={levelFilter}
                  onChange={(e) => setLevelFilter(e.target.value)}
                  style={{padding: '12px 16px', background: 'rgba(255,255,255,0.1)', border: '1px solid rgba(255,255,255,0.1)', borderRadius: '12px', color: 'white', fontSize: '14px', outline: 'none', cursor: 'pointer'}}
                >
                  <option value="All" style={{background: '#1E293B'}}>All Levels</option>
                  <option value="Federal" style={{background: '#1E293B'}}>Federal</option>
                  <option value="State" style={{background: '#1E293B'}}>State</option>
                  <option value="Local" style={{background: '#1E293B'}}>Local</option>
                </select>
                <select
                  value={priorityFilter}
                  onChange={(e) => setPriorityFilter(e.target.value)}
                  style={{padding: '12px 16px', background: 'rgba(255,255,255,0.1)', border: '1px solid rgba(255,255,255,0.1)', borderRadius: '12px', color: 'white', fontSize: '14px', outline: 'none', cursor: 'pointer'}}
                >
                  <option value="All" style={{background: '#1E293B'}}>All Priorities</option>
                  <option value="RED" style={{background: '#1E293B'}}>üî¥ Urgent</option>
                  <option value="YELLOW" style={{background: '#1E293B'}}>üü° Important</option>
                  <option value="GREEN" style={{background: '#1E293B'}}>üü¢ Monitor</option>
                </select>
              </div>
            </div>

            {/* Bills List */}
            <div style={{display: 'flex', flexDirection: 'column', gap: '16px'}}>
              {filteredBills.map(bill => (
                <BillCard key={bill.id} bill={bill} onClick={() => setSelectedBill(bill)} />
              ))}
              {filteredBills.length === 0 && (
                <div style={{textAlign: 'center', padding: '48px', color: 'rgba(255,255,255,0.5)'}}>
                  <p style={{fontSize: '48px', margin: '0 0 16px 0'}}>üîç</p>
                  <p>{bills.length === 0 ? 'No bills in spreadsheet yet' : 'No bills match your search'}</p>
                </div>
              )}
            </div>
          </main>

          {/* Modal */}
          {selectedBill && <Modal bill={selectedBill} onClose={() => setSelectedBill(null)} />}

          {/* Footer */}
          <footer style={{textAlign: 'center', padding: '24px', color: 'rgba(255,255,255,0.3)', fontSize: '14px'}}>
            Progressive Issue Tracker ‚Ä¢ Data synced from Google Sheets
          </footer>
        </div>
      );
    }

    function StatCard({ emoji, label, value, color }) {
      return (
        <div style={{background: 'rgba(255,255,255,0.05)', backdropFilter: 'blur(10px)', borderRadius: '16px', border: '1px solid rgba(255,255,255,0.1)', padding: '20px', transition: 'all 0.2s'}}>
          <div style={{width: '40px', height: '40px', borderRadius: '12px', background: color, display: 'flex', alignItems: 'center', justifyContent: 'center', marginBottom: '12px', fontSize: '20px'}}>
            {emoji}
          </div>
          <p style={{margin: 0, fontSize: '32px', fontWeight: 'bold', color: 'white'}}>{value}</p>
          <p style={{margin: '4px 0 0 0', fontSize: '14px', color: 'rgba(255,255,255,0.5)'}}>{label}</p>
        </div>
      );
    }

    function BillCard({ bill, onClick }) {
      const priority = priorityStyles[bill.priority] || priorityStyles.GREEN;
      const level = levelStyles[bill.level] || levelStyles.Federal;

      return (
        <div
          onClick={onClick}
          style={{background: 'rgba(255,255,255,0.05)', backdropFilter: 'blur(10px)', borderRadius: '16px', border: '1px solid rgba(255,255,255,0.1)', padding: '20px', cursor: 'pointer', transition: 'all 0.2s'}}
          onMouseEnter={(e) => { e.currentTarget.style.background = 'rgba(255,255,255,0.1)'; e.currentTarget.style.borderColor = 'rgba(139, 92, 246, 0.5)'; }}
          onMouseLeave={(e) => { e.currentTarget.style.background = 'rgba(255,255,255,0.05)'; e.currentTarget.style.borderColor = 'rgba(255,255,255,0.1)'; }}
        >
          <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', gap: '16px'}}>
            <div style={{flex: 1, minWidth: 0}}>
              {/* Tags */}
              <div style={{display: 'flex', flexWrap: 'wrap', gap: '8px', marginBottom: '12px'}}>
                <span style={{padding: '4px 10px', borderRadius: '8px', fontSize: '12px', fontWeight: '500', background: level.bg, color: level.text}}>{bill.level}</span>
                <span style={{padding: '4px 10px', borderRadius: '8px', fontSize: '12px', fontWeight: '500', background: priority.bg, color: priority.text}}>{priority.label}</span>
                {bill.contacted && <span style={{padding: '4px 10px', borderRadius: '8px', fontSize: '12px', fontWeight: '500', background: 'rgba(16, 185, 129, 0.2)', color: '#34D399'}}>‚úì Contacted</span>}
              </div>
              {/* Title */}
              <h3 style={{margin: '0 0 4px 0', fontSize: '20px', fontWeight: 'bold', color: 'white'}}>{bill.billIssue}</h3>
              <p style={{margin: '0 0 12px 0', color: 'rgba(255,255,255,0.7)'}}>{bill.description}</p>
              {/* Meta */}
              <div style={{display: 'flex', flexWrap: 'wrap', gap: '16px', fontSize: '14px', color: 'rgba(255,255,255,0.5)'}}>
                <span>üìç {bill.status}</span>
                {bill.actionDeadline && <span>üìÖ Deadline: {bill.actionDeadline}</span>}
                {bill.repsToContact && <span>üë• {bill.repsToContact}</span>}
              </div>
            </div>
            <span style={{color: 'rgba(255,255,255,0.3)', fontSize: '24px'}}>‚Üí</span>
          </div>
        </div>
      );
    }

    function Modal({ bill, onClose }) {
      const priority = priorityStyles[bill.priority] || priorityStyles.GREEN;

      return (
        <div
          onClick={onClose}
          style={{position: 'fixed', inset: 0, background: 'rgba(0,0,0,0.6)', backdropFilter: 'blur(4px)', display: 'flex', alignItems: 'center', justifyContent: 'center', padding: '16px', zIndex: 50}}
        >
          <div
            onClick={(e) => e.stopPropagation()}
            style={{background: '#0F172A', borderRadius: '24px', border: '1px solid rgba(255,255,255,0.1)', maxWidth: '600px', width: '100%', maxHeight: '90vh', overflow: 'auto', boxShadow: '0 25px 50px rgba(0,0,0,0.5)'}}
          >
            {/* Header */}
            <div style={{background: priority.gradient, padding: '24px', borderRadius: '24px 24px 0 0'}}>
              <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start'}}>
                <div>
                  <div style={{display: 'flex', gap: '8px', marginBottom: '8px'}}>
                    <span style={{padding: '4px 10px', borderRadius: '8px', fontSize: '12px', fontWeight: '500', background: 'rgba(255,255,255,0.2)', color: 'white'}}>{bill.level}</span>
                    <span style={{padding: '4px 10px', borderRadius: '8px', fontSize: '12px', fontWeight: '500', background: 'rgba(255,255,255,0.2)', color: 'white'}}>Added {bill.dateAdded}</span>
                  </div>
                  <h2 style={{margin: '0 0 4px 0', fontSize: '28px', fontWeight: 'bold', color: 'white'}}>{bill.billIssue}</h2>
                  <p style={{margin: 0, fontSize: '18px', color: 'rgba(255,255,255,0.9)'}}>{bill.description}</p>
                </div>
                <button
                  onClick={onClose}
                  style={{background: 'rgba(255,255,255,0.2)', border: 'none', borderRadius: '50%', width: '36px', height: '36px', color: 'white', fontSize: '18px', cursor: 'pointer', display: 'flex', alignItems: 'center', justifyContent: 'center'}}
                >
                  ‚úï
                </button>
              </div>
            </div>

            {/* Content */}
            <div style={{padding: '24px', display: 'flex', flexDirection: 'column', gap: '20px'}}>
              {/* Status boxes */}
              <div style={{display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '16px'}}>
                <div style={{background: 'rgba(255,255,255,0.05)', borderRadius: '16px', padding: '16px'}}>
                  <p style={{margin: '0 0 4px 0', fontSize: '12px', color: 'rgba(255,255,255,0.5)'}}>üìç Current Status</p>
                  <p style={{margin: 0, fontWeight: '600', color: 'white'}}>{bill.status || 'Not specified'}</p>
                </div>
                <div style={{background: bill.priority === 'RED' ? 'rgba(239, 68, 68, 0.2)' : 'rgba(255,255,255,0.05)', borderRadius: '16px', padding: '16px', border: bill.priority === 'RED' ? '1px solid rgba(239, 68, 68, 0.3)' : 'none'}}>
                  <p style={{margin: '0 0 4px 0', fontSize: '12px', color: bill.priority === 'RED' ? '#FCA5A5' : 'rgba(255,255,255,0.5)'}}>üìÖ Action Deadline</p>
                  <p style={{margin: 0, fontWeight: '600', color: bill.priority === 'RED' ? '#FCA5A5' : 'white'}}>{bill.actionDeadline || 'No deadline set'}</p>
                </div>
              </div>

              {/* Reps */}
              {bill.repsToContact && (
                <div style={{background: 'rgba(255,255,255,0.05)', borderRadius: '16px', padding: '16px'}}>
                  <p style={{margin: '0 0 12px 0', fontWeight: '600', color: 'white'}}>üë• Representatives to Contact</p>
                  <div style={{display: 'flex', flexWrap: 'wrap', gap: '8px'}}>
                    {bill.repsToContact.split(', ').map(rep => (
                      <span key={rep} style={{padding: '8px 14px', background: 'rgba(139, 92, 246, 0.2)', color: '#C4B5FD', borderRadius: '12px', fontSize: '14px', fontWeight: '500'}}>{rep}</span>
                    ))}
                  </div>
                </div>
              )}

              {/* Contact status */}
              <div style={{background: 'rgba(255,255,255,0.05)', borderRadius: '16px', padding: '16px', display: 'flex', justifyContent: 'space-between', alignItems: 'center'}}>
                <div>
                  <p style={{margin: '0 0 4px 0', fontWeight: '600', color: 'white'}}>Contact Status</p>
                  <p style={{margin: 0, fontSize: '14px', color: 'rgba(255,255,255,0.6)'}}>{bill.contacted ? (bill.notes || 'Representatives contacted') : 'Not yet contacted'}</p>
                </div>
                <div style={{width: '48px', height: '48px', borderRadius: '50%', background: bill.contacted ? 'rgba(16, 185, 129, 0.2)' : 'rgba(245, 158, 11, 0.2)', display: 'flex', alignItems: 'center', justifyContent: 'center', fontSize: '24px'}}>
                  {bill.contacted ? '‚úÖ' : '‚è≥'}
                </div>
              </div>

              {/* Notes */}
              {bill.notes && (
                <div style={{background: 'rgba(255,255,255,0.05)', borderRadius: '16px', padding: '16px'}}>
                  <p style={{margin: '0 0 8px 0', fontWeight: '600', color: 'white'}}>üìù Notes</p>
                  <p style={{margin: 0, color: 'rgba(255,255,255,0.7)'}}>{bill.notes}</p>
                </div>
              )}

              {/* Actions */}
              <div style={{display: 'flex', gap: '12px', flexWrap: 'wrap'}}>
                <button style={{flex: 1, padding: '14px 20px', background: 'linear-gradient(135deg, #8B5CF6, #D946EF)', border: 'none', borderRadius: '12px', color: 'white', fontWeight: '600', fontSize: '14px', cursor: 'pointer', minWidth: '200px'}}>
                  üë• Contact Representatives
                </button>
                <button style={{flex: 1, padding: '14px 20px', background: 'rgba(255,255,255,0.1)', border: 'none', borderRadius: '12px', color: 'white', fontWeight: '600', fontSize: '14px', cursor: 'pointer', minWidth: '200px'}}>
                  ‚úÖ Mark as Contacted
                </button>
              </div>
            </div>
          </div>
        </div>
      );
    }

    // Render the app
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>
